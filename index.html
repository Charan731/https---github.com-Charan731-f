<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay 1 Rupee</title>
    <script>
        async function fetchBalance() {
            try {
                const response = await fetch('https://charan-fgp9.onrender.com/balance'); // Fetch from backend
                const data = await response.json();
                document.getElementById('balance').innerText = `Balance: ${data.balance}`;
            } catch (error) {
                console.error("Error fetching balance:", error);
            }
        }

        function listenToPaymentSuccess() {
            const razorpayBtn = document.querySelector('script[data-payment_button_id]');
            if (razorpayBtn) {
                razorpayBtn.addEventListener('load', () => {
                    console.log("Razorpay button loaded");
                });

                window.addEventListener('message', (event) => {
                    if (event.data && event.data.razorpay_payment_id) {
                        console.log("Payment Successful:", event.data.razorpay_payment_id);
                        setTimeout(fetchBalance, 5000); // Fetch updated balance after 5 seconds
                    }
                });
            }
        }

        window.onload = function () {
            fetchBalance();
            listenToPaymentSuccess();
        };
    </script>
</head>
<body>
    <h1>Pay 1 Rupee to See How Many Rupees</h1>
    <form>
        <script src="https://checkout.razorpay.com/v1/payment-button.js" data-payment_button_id="pl_Q1VPKynGzRQl5H" async></script>
    </form>
    <h2 id="balance">Balance: 0</h2>
</body>
</html>
